<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>saneel.ai | Intelligent Research</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Marked.js for formatting -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">

    <style>
        /* Modern Dark Theme styling */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f1115; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
        
        body { font-family: 'Inter', sans-serif; background-color: #0f1115; color: #cbd5e1; }
        pre, code { font-family: 'JetBrains Mono', monospace; }

        /* Animation for bubbles */
        .fade-in-up { animation: fadeInUp 0.3s ease-out forwards; opacity: 0; transform: translateY(10px); }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

        /* Markdown Styles */
        .prose strong { color: #fff; font-weight: 600; }
        .prose ul { list-style-type: disc; padding-left: 20px; margin: 10px 0; }
        .prose ol { list-style-type: decimal; padding-left: 20px; margin: 10px 0; }
        .prose h3 { font-size: 1.1em; color: #fff; font-weight: 600; margin-top: 15px; margin-bottom: 5px; }
        .prose code { background: #1e293b; padding: 2px 6px; border-radius: 4px; font-size: 0.9em; color: #60a5fa; }
    </style>
</head>
<body class="h-screen flex overflow-hidden">

    <!-- SIDEBAR (Collapsible) -->
    <aside class="w-64 bg-[#0b0d10] border-r border-slate-800 flex flex-col hidden md:flex z-20">
        <!-- Logo Area -->
        <div class="p-5 border-b border-slate-800 flex items-center gap-3">
            <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center shadow-[0_0_15px_rgba(37,99,235,0.3)]">
                <i class="fa-solid fa-brain text-white text-sm"></i>
            </div>
            <span class="font-semibold text-white tracking-tight">saneel.ai</span>
        </div>

        <!-- New Chat -->
        <div class="p-4">
            <button onclick="clearChat()" class="w-full bg-slate-800/50 hover:bg-slate-800 text-slate-200 py-2.5 px-4 rounded-lg border border-slate-700/50 flex items-center gap-3 transition-all text-sm font-medium hover:border-slate-600">
                <i class="fa-solid fa-plus text-blue-500"></i> New Session
            </button>
        </div>

        <!-- History -->
        <div class="flex-1 overflow-y-auto px-2 py-2">
            <div class="text-[10px] text-slate-500 uppercase font-bold tracking-wider px-4 mb-2">Local History</div>
            <div id="history-list" class="space-y-1"></div>
        </div>

        <!-- Footer -->
        <div class="p-4 border-t border-slate-800">
            <button onclick="toggleSettings()" class="flex items-center gap-3 text-slate-400 hover:text-white text-xs transition w-full p-2 rounded hover:bg-slate-800/50">
                <i class="fa-solid fa-sliders"></i> System Config
            </button>
        </div>
    </aside>

    <!-- MAIN CHAT AREA -->
    <main class="flex-1 flex flex-col relative bg-[#0f1115]">
        
        <!-- Mobile Header -->
        <div class="md:hidden h-14 bg-[#0b0d10] border-b border-slate-800 flex items-center justify-between px-4">
            <span class="font-semibold text-white flex items-center gap-2">
                <i class="fa-solid fa-brain text-blue-500"></i> saneel.ai
            </span>
        </div>

        <!-- Messages -->
        <div id="chat-container" class="flex-1 overflow-y-auto p-4 md:p-8 space-y-6 scroll-smooth">
            <!-- Welcome Screen -->
            <div id="welcome" class="flex flex-col items-center justify-center h-full text-center space-y-6 animate-fade-in-up">
                <div class="w-16 h-16 bg-slate-800/50 rounded-2xl flex items-center justify-center mb-2 shadow-xl ring-1 ring-white/10">
                    <i class="fa-solid fa-shield-halved text-3xl text-blue-500"></i>
                </div>
                <div>
                    <h2 class="text-2xl font-semibold text-white mb-2">Secure Research Environment</h2>
                    <p class="text-slate-400 text-sm max-w-sm mx-auto">
                        Operating in <span class="text-green-400 font-mono text-xs bg-green-400/10 px-2 py-0.5 rounded">LOCAL_SAFE_MODE</span>. 
                        Chats are stored on this device only.
                    </p>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm w-full max-w-lg px-6">
                    <button onclick="quickFill('Create a project roadmap')" class="bg-[#1a1d24] border border-slate-800 p-3 rounded-xl hover:bg-slate-800 hover:border-slate-600 transition text-left text-slate-300">
                        <i class="fa-regular fa-map text-blue-500 mr-2"></i> Create a project roadmap
                    </button>
                    <button onclick="quickFill('Analyze potential risks')" class="bg-[#1a1d24] border border-slate-800 p-3 rounded-xl hover:bg-slate-800 hover:border-slate-600 transition text-left text-slate-300">
                        <i class="fa-solid fa-magnifying-glass-chart text-purple-500 mr-2"></i> Analyze potential risks
                    </button>
                </div>
            </div>
        </div>

        <!-- Input Area -->
        <div class="p-4 bg-[#0f1115]">
            <div class="max-w-3xl mx-auto relative bg-[#1e293b]/50 rounded-xl border border-slate-700/50 shadow-2xl backdrop-blur-sm">
                <textarea id="user-input" rows="1" class="w-full bg-transparent text-white p-4 pr-12 focus:outline-none resize-none max-h-32 text-sm" placeholder="Message saneel.ai..." onkeydown="handleKey(event)"></textarea>
                <button onclick="sendMessage()" class="absolute bottom-2 right-2 p-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg transition-all shadow-lg shadow-blue-500/20">
                    <i class="fa-solid fa-arrow-up"></i>
                </button>
            </div>
            <div class="text-center mt-2">
                <p class="text-[10px] text-slate-600 font-mono">saneel.ai v1.0.4 | Secure Connection</p>
            </div>
        </div>
    </main>

    <!-- HIDDEN SETTINGS (Only opens if you click) -->
    <div id="settings-modal" class="fixed inset-0 bg-black/80 hidden z-50 flex items-center justify-center backdrop-blur-sm">
        <div class="bg-[#0b0d10] border border-slate-800 rounded-xl w-[90%] max-w-md p-6 shadow-2xl relative">
            <button onclick="toggleSettings()" class="absolute top-4 right-4 text-slate-500 hover:text-white"><i class="fa-solid fa-xmark"></i></button>
            <h3 class="text-lg font-semibold text-white mb-4">Connection Settings</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-xs font-medium text-slate-400 mb-2">Gemini API Key (Optional)</label>
                    <input type="password" id="api-key" class="w-full bg-[#161b22] border border-slate-800 rounded-lg p-3 text-white text-sm focus:border-blue-500 focus:outline-none transition" placeholder="sk-...">
                    <p class="text-[11px] text-slate-500 mt-2">If empty, system uses <b>Simulated Intelligence</b> (Perfect for Demos).</p>
                </div>
                <button onclick="saveSettings()" class="w-full bg-blue-600 hover:bg-blue-500 text-white py-2 rounded-lg font-medium text-sm transition">Save Configuration</button>
            </div>
        </div>
    </div>

    <script>
        // --- LOGIC ---
        let apiKey = localStorage.getItem('saneel_api_key') || '';
        const chatBox = document.getElementById('chat-container');
        const welcome = document.getElementById('welcome');
        const input = document.getElementById('user-input');

        // 1. SMART SIMULATION (No API Key Needed)
        // These answers trigger if the user DOES NOT have a key.
        const mockBrain = {
            'hello': "Hello! I am **saneel.ai**, your private research assistant. I am ready to secure your data and assist with your project.",
            'roadmap': "### Project Roadmap Strategy\n\n1. **Phase 1: Conceptualization**\n   - Define core objectives.\n   - Assess technical feasibility.\n2. **Phase 2: Development**\n   - Build MVP (Minimum Viable Product).\n   - Conduct security audits.\n3. **Phase 3: Deployment**\n   - Beta testing in secure environment.\n   - Full launch.",
            'risk': "### Risk Analysis Report\n\n- **Data Privacy:** High Priority. Mitigated by local storage architecture.\n- **Scalability:** Moderate. Recommended to use modular backend.\n- **Timeline:** Low Risk. Current velocity suggests on-time delivery.",
            'analyze': "Processing data stream...\n\n**Analysis Complete:**\nThe proposed architecture minimizes latency by keeping logic client-side. This ensures 100% uptime even without external internet connectivity.",
            'secret': "Security Protocol: **ACTIVE**.\nAll conversation logs are encrypted locally. No data is being transmitted to external servers.",
            'default': "I have processed that input locally. \n\nSince I am operating in **Secure Demo Mode** (No API Key), I cannot browse the live internet, but I have logged this query into your private research history."
        };

        // 2. SEND MESSAGE LOGIC
        async function sendMessage() {
            const text = input.value.trim();
            if (!text) return;

            // UI Cleanup
            welcome.style.display = 'none';
            input.value = '';
            input.style.height = 'auto';

            // User Bubble
            addBubble(text, 'user');

            // Loading Bubble
            const loadingId = addLoading();

            // DECISION: Real API or Mock?
            let responseText = "";
            
            if (apiKey) {
                // REAL GEMINI CALL
                try {
                    responseText = await callGemini(text);
                } catch (e) {
                    responseText = "Connection Error: " + e.message;
                }
            } else {
                // SMART SIMULATION CALL (The fix!)
                await new Promise(r => setTimeout(r, 1500)); // Fake "thinking" delay
                const lower = text.toLowerCase();
                responseText = mockBrain['default'];
                
                // Check keywords
                for (const key in mockBrain) {
                    if (lower.includes(key)) {
                        responseText = mockBrain[key];
                        break;
                    }
                }
            }

            removeLoading(loadingId);
            addBubble(responseText, 'ai');
            saveToHistory(text);
        }

        // 3. GEMINI API FUNCTION (Only if key exists)
        async function callGemini(prompt) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`;
            const res = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
            });
            const data = await res.json();
            if (data.error) throw new Error(data.error.message);
            return data.candidates[0].content.parts[0].text;
        }

        // 4. UI BUILDERS
        function addBubble(text, role) {
            const div = document.createElement('div');
            div.className = `flex w-full ${role === 'user' ? 'justify-end' : 'justify-start'} fade-in-up`;
            
            const inner = document.createElement('div');
            inner.className = `max-w-[85%] md:max-w-[75%] rounded-2xl p-4 shadow-sm text-sm leading-relaxed ${
                role === 'user' 
                ? 'bg-blue-600 text-white rounded-br-none' 
                : 'bg-[#1e293b] border border-slate-700 text-slate-200 rounded-bl-none prose'
            }`;

            if (role === 'ai') inner.innerHTML = marked.parse(text);
            else inner.textContent = text;

            div.appendChild(inner);
            chatBox.appendChild(div);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function addLoading() {
            const id = 'loader-' + Date.now();
            const div = document.createElement('div');
            div.id = id;
            div.className = 'flex w-full justify-start fade-in-up';
            div.innerHTML = `<div class="bg-[#1e293b] border border-slate-700 rounded-2xl rounded-bl-none p-4 flex gap-2 items-center"><div class="w-2 h-2 bg-slate-500 rounded-full animate-bounce"></div><div class="w-2 h-2 bg-slate-500 rounded-full animate-bounce" style="animation-delay:0.1s"></div><div class="w-2 h-2 bg-slate-500 rounded-full animate-bounce" style="animation-delay:0.2s"></div></div>`;
            chatBox.appendChild(div);
            chatBox.scrollTop = chatBox.scrollHeight;
            return id;
        }

        function removeLoading(id) {
            const el = document.getElementById(id);
            if (el) el.remove();
        }

        // 5. UTILS
        function handleKey(e) {
            if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
        }
        function quickFill(text) { input.value = text; sendMessage(); }
        function toggleSettings() { 
            const el = document.getElementById('settings-modal');
            el.classList.toggle('hidden');
            document.getElementById('api-key').value = apiKey;
        }
        function saveSettings() {
            apiKey = document.getElementById('api-key').value.trim();
            localStorage.setItem('saneel_api_key', apiKey);
            toggleSettings();
            addBubble("System configuration updated.", "ai");
        }
        function saveToHistory(title) {
            const list = document.getElementById('history-list');
            const btn = document.createElement('button');
            btn.className = "w-full text-left px-4 py-2 hover:bg-slate-800/50 rounded text-xs text-slate-400 truncate";
            btn.innerHTML = `<i class="fa-regular fa-message mr-2"></i> ${title}`;
            list.prepend(btn);
        }
        function clearChat() {
            location.reload();
        }
    </script>
</body>
</html>
